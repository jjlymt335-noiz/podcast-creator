<!DOCTYPE html>
<html>
<head>
  <title>Test Auto-Assign API</title>
  <script type="module">
    // æµ‹è¯•æ–‡æœ¬
    const testText = `A (ä¸»æŒäºº): ä½ å¥½ï¼Œæ¬¢è¿æ”¶å¬ä»Šå¤©çš„èŠ‚ç›®ã€‚
B (å˜‰å®¾): è°¢è°¢é‚€è¯·ï¼Œå¾ˆé«˜å…´æ¥åˆ°è¿™é‡Œã€‚
A (ä¸»æŒäºº): ä»Šå¤©æˆ‘ä»¬è¦è®¨è®ºä¸€ä¸ªå¾ˆé‡è¦çš„è¯é¢˜ã€‚
B (å˜‰å®¾): æ²¡é”™ï¼Œè¿™ä¸ªè¯é¢˜ç¡®å®å€¼å¾—æ·±å…¥æ¢è®¨ã€‚`;

    // Gemini APIé…ç½®
    const GEMINI_API_KEY = 'AIzaSyCsYGl-Pzhs8SwGgtBsCrvHvXMzSc7BBlU';
    const GEMINI_MODEL = 'gemini-2.5-flash-latest';
    const GEMINI_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL}:generateContent`;

    async function testGeminiAPI() {
      console.log('ğŸ§ª Testing Gemini API...');
      console.log('Text:', testText);

      const prompt = `ä½ æ˜¯ä¸€ä¸ªå¯¹è¯åˆ†æä¸“å®¶ã€‚è¯·åˆ†æä»¥ä¸‹å¯¹è¯æ–‡æœ¬ï¼Œè¯†åˆ«æ¯ä¸ªè¯´è¯äººçš„ç‰¹å¾ã€‚

å¯¹è¯æ–‡æœ¬ï¼š
${testText}

è¯·ä¸ºæ¯ä¸ªè¯´è¯äººæä¾›ï¼š
1. genderï¼ˆæ€§åˆ«ï¼‰: male/female/neutral
2. ageï¼ˆå¹´é¾„æ®µï¼‰: child/young_adult/adult/elderly
3. personality_traitsï¼ˆæ€§æ ¼ç‰¹å¾ï¼‰: 3-5ä¸ªå½¢å®¹è¯
4. voice_descriptionï¼ˆå£°éŸ³æè¿°ï¼‰: 50å­—å·¦å³çš„è‡ªç„¶è¯­è¨€æè¿°
5. suggested_tagsï¼ˆæ¨èæ ‡ç­¾ï¼‰: 5-8ä¸ªæ ‡ç­¾ï¼Œç”¨äºéŸ³è‰²æœç´¢

ä»¥JSONæ ¼å¼è¿”å›ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š
{
  "speakers": [
    {
      "speaker_name": "A (ä¸»æŒäºº)",
      "gender": "male",
      "age": "adult",
      "personality_traits": ["professional", "warm"],
      "voice_description": "A warm and professional male voice...",
      "suggested_tags": ["professional", "warm", "narrator"]
    }
  ]
}`;

      try {
        const response = await fetch(GEMINI_API_URL + '?key=' + GEMINI_API_KEY, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            contents: [{
              parts: [{
                text: prompt
              }]
            }],
            generationConfig: {
              temperature: 0.7,
              maxOutputTokens: 2048,
            }
          })
        });

        if (!response.ok) {
          const error = await response.text();
          console.error('âŒ Gemini API failed:', error);
          document.getElementById('result').innerHTML = `<pre style="color: red;">Gemini API Error:\n${error}</pre>`;
          return;
        }

        const data = await response.json();
        console.log('âœ… Gemini Response:', data);

        const text = data.candidates[0].content.parts[0].text;
        console.log('ğŸ“ Raw text:', text);

        // æå–JSON
        const jsonMatch = text.match(/\{[\s\S]*\}/);
        if (jsonMatch) {
          const result = JSON.parse(jsonMatch[0]);
          console.log('âœ… Parsed result:', result);
          document.getElementById('result').innerHTML = `<pre>${JSON.stringify(result, null, 2)}</pre>`;
        } else {
          console.error('âŒ No JSON found in response');
          document.getElementById('result').innerHTML = `<pre style="color: red;">No JSON in response:\n${text}</pre>`;
        }
      } catch (error) {
        console.error('âŒ Error:', error);
        document.getElementById('result').innerHTML = `<pre style="color: red;">Error: ${error.message}</pre>`;
      }
    }

    async function testNoizVoiceLibrary() {
      console.log('ğŸ§ª Testing Noiz Voice Library API...');

      const NOIZ_API_BASE = 'https://api.noiz.ai';
      const NOIZ_API_KEY = 'ZTEwYTFjZWEtOTU3My00YjAzLTkyM2UtYWRlY2JiY2Y0MjZmJGpqbHltdDMzNUBnbWFpbC5jb20=';

      try {
        const response = await fetch(NOIZ_API_BASE + '/api/v1/voices/public?page=1&page_size=10', {
          headers: {
            'Authorization': `Bearer ${NOIZ_API_KEY}`,
            'Content-Type': 'application/json',
          }
        });

        if (!response.ok) {
          const error = await response.text();
          console.error('âŒ Noiz API failed:', error);
          document.getElementById('voice-result').innerHTML = `<pre style="color: red;">Noiz API Error:\n${error}</pre>`;
          return;
        }

        const data = await response.json();
        console.log('âœ… Noiz Voice Library Response:', data);
        document.getElementById('voice-result').innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
      } catch (error) {
        console.error('âŒ Error:', error);
        document.getElementById('voice-result').innerHTML = `<pre style="color: red;">Error: ${error.message}</pre>`;
      }
    }

    // é¡µé¢åŠ è½½åè‡ªåŠ¨æµ‹è¯•
    window.addEventListener('load', () => {
      document.getElementById('test-gemini').addEventListener('click', testGeminiAPI);
      document.getElementById('test-noiz').addEventListener('click', testNoizVoiceLibrary);
    });
  </script>
  <style>
    body {
      font-family: monospace;
      padding: 20px;
      background: #1a1a1a;
      color: #fff;
    }
    button {
      padding: 10px 20px;
      margin: 10px;
      font-size: 16px;
      cursor: pointer;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
    }
    button:hover {
      background: #45a049;
    }
    pre {
      background: #2a2a2a;
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
    }
    h2 {
      color: #4CAF50;
    }
  </style>
</head>
<body>
  <h1>ğŸ§ª Auto-Assign API æµ‹è¯•</h1>

  <h2>1. æµ‹è¯• Gemini APIï¼ˆè§’è‰²åˆ†æï¼‰</h2>
  <button id="test-gemini">æµ‹è¯• Gemini API</button>
  <div id="result"></div>

  <h2>2. æµ‹è¯• Noiz Voice Library API</h2>
  <button id="test-noiz">æµ‹è¯• Noiz API</button>
  <div id="voice-result"></div>

  <h2>æµ‹è¯•æ–‡æœ¬ï¼š</h2>
  <pre>A (ä¸»æŒäºº): ä½ å¥½ï¼Œæ¬¢è¿æ”¶å¬ä»Šå¤©çš„èŠ‚ç›®ã€‚
B (å˜‰å®¾): è°¢è°¢é‚€è¯·ï¼Œå¾ˆé«˜å…´æ¥åˆ°è¿™é‡Œã€‚
A (ä¸»æŒäºº): ä»Šå¤©æˆ‘ä»¬è¦è®¨è®ºä¸€ä¸ªå¾ˆé‡è¦çš„è¯é¢˜ã€‚
B (å˜‰å®¾): æ²¡é”™ï¼Œè¿™ä¸ªè¯é¢˜ç¡®å®å€¼å¾—æ·±å…¥æ¢è®¨ã€‚</pre>
</body>
</html>
